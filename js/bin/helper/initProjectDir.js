import path from "path";
import * as fs from "fs/promises";
import fileSelector from "inquirer-file-selector";
import { input } from "@inquirer/prompts";

async function selectAndCreateProjectDir(projectDirPath) {
  if (projectDirPath == null || projectDirPath == undefined) {
    projectDirPath = await fileSelector({
      message: "Select a directory to create project in:",
      type: "directory",
      filter: (file) => {
        return file.isDirectory();
      },
    });
    const projectName = await input({
      message: "Enter the project name:",
      default: "myNodeProject",
    });
    projectDirPath = path.join(projectDirPath, projectName);
    await fs.mkdir(projectDirPath, { recursive: true });

    const dbFilePath = path.join(projectDirPath, 'servitectDB.json');

    try {
        // Check if the file already exists
        await fs.access(dbFilePath);
       
    } catch (error) {
        // If file doesn't exist, create it
        const jsonData = {
            "_note": "⚠️ DO NOT EDIT THIS FILE. Changes may break the system.",
            "isBackendInitialized": false,
            "isFrontendInitialized": false
        };

        await fs.writeFile(dbFilePath, JSON.stringify(jsonData, null, 2), 'utf8');
      
    }
    return projectDirPath;
  }
}

export default selectAndCreateProjectDir;
